(window.webpackJsonp=window.webpackJsonp||[]).push([["app"],{0:function(e,t,s){e.exports=s("cd49")},"13ec":function(e,t,s){"use strict";s.d(t,"b",(function(){return d})),s.d(t,"a",(function(){return p})),s.d(t,"c",(function(){return m})),s.d(t,"f",(function(){return l})),s.d(t,"e",(function(){return u})),s.d(t,"d",(function(){return f}));s("d9e2"),s("14d9"),s("a573"),s("88a7"),s("271a"),s("5494");var a=s("f64c"),n=s("bc3a"),o=s.n(n),r=s("c0e9"),i=s.n(r),c=(s("21a6"),s("2ef0"));const d=e=>{const t=function(e,t){const{format:s,size:a}=t,n=!s||s.includes(e.type),o=!a||e.size/1024/1024<a;let r=null;return n||(r="format"),o||(r="size"),{passed:n&&o,error:r}}(e,{format:["image/jpeg","image/png"],size:1}),{passed:s,error:n}=t;return"format"===n&&a.a.error("上传图片只能是 JPG/PNG 格式!"),"size"===n&&a.a.error("上传图片大小不能超过 1Mb"),s};function p(e,t){let s=e.target;if(s.classList.contains(t))return s;for(;s;){if(s.classList&&s.classList.contains(t))return s;s=s.parentNode}return!1}const m=e=>new Promise((t,s)=>{const a=new Image;a.src=URL.createObjectURL(e),a.onload=()=>{const{naturalWidth:e,naturalHeight:s}=a;t({width:e,height:s})},a.onerror=()=>{s(new Error("There was some problem with the image."))}});const l=e=>{const t=document.getElementById(e);return i()(t,{allowTaint:!1,useCORS:!0,width:375}).then(e=>new Promise((t,s)=>{e.toBlob(e=>{if(e){const a=new File([e],"screenshot.png"),n=new FormData;n.append("file",a),o.a.post("/utils/upload-img",n,{headers:{"Content-Type":"multipart/form-data"},timeout:5e3}).then(e=>{t(e.data)}).catch(e=>{s(e)})}else s(new Error("blob data error"))},"image/png")}))},u=e=>Object(c.map)(e,(e,t)=>`${t}=${e}`).join("&"),f=(e,t,s)=>[...e.slice(0,t),s,...e.slice(t)]},4678:function(e,t,s){var a={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-ps":"4c98","./ar-ps.js":"4c98","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku-kmr":"7558","./ku-kmr.js":"7558","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function n(e){var t=o(e);return s(t)}function o(e){if(!s.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=o,e.exports=n,n.id="4678"},cd49:function(e,t,s){"use strict";s.r(t),s.d(t,"baseBackendURL",(function(){return P})),s.d(t,"baseH5URL",(function(){return S})),s.d(t,"baseStaticURL",(function(){return T}));var a=s("7a23"),n=s("bc3a"),o=s.n(n),r=s("f23d"),i=s("a17c");s("3aed"),s("f004"),s("6107");const c={id:"app"};var d=s("6b0d");const p={};var m=s.n(d)()(p,[["render",function(e,t){const s=Object(a.Q)("router-view");return Object(a.J)(),Object(a.l)("div",c,[Object(a.p)(s)])}]]),l=s("6605");const u=[{path:"/",name:"Editor",component:()=>s.e("editorState").then(s.bind(null,"49d7")),meta:{requiredLogin:!0,title:"编辑我的设计"}}];var f=Object(l.a)({history:Object(l.b)(),routes:u,scrollBehavior:(e,t,s)=>s||Promise.resolve({left:0,top:0})}),h=s("5502"),b=(s("14d9"),s("0643"),s("2382"),s("fffc"),s("4e3e"),s("a573"),s("ec26")),j=s("2ef0"),g=s("13ec");const k={backgroundColor:"#ffffff",backgroundImage:"",backgroundRepeat:"no-repeat",backgroundSize:"cover",height:"560px"},y=(e,t)=>{-1!==e.historyIndex&&(e.histories=e.histories.slice(0,e.historyIndex),e.historyIndex=-1),e.histories.length<20||e.histories.shift(),e.histories.push(t)},w=(e,t,s)=>{const{componentId:a,data:n}=t,{key:o,oldValue:r,newValue:i}=n;if(a){const t=e.components.find(e=>e.id===a);Array.isArray(o)?o.forEach((e,a)=>{t.props[e]="undo"===s?r[a]:i[a]}):t.props[o]="undo"===s?r:i}else e.page.props[o]="undo"===s?r:i};let v,x=0;const I=(e,t,s=1e3)=>{x&&clearTimeout(x),Object(j.isUndefined)(v)&&(v=e),x=setTimeout(()=>{t(),x=0,v=void 0},s)};var C={state:{components:[],currentElement:"",currentEditing:"",isDirty:!1,isChangedNotPublished:!1,page:{props:k,setting:{}},channels:[],histories:[],historyIndex:-1},mutations:{resetEditor(e){e.page={props:k,setting:{}},e.components=[],e.histories=[],e.isDirty=!1,e.isChangedNotPublished=!1},addComponentToEditor(e,t){t.id=Object(b.a)(),t.layerName="图层"+(e.components.length+1),e.components.push(t),y(e,{id:Object(b.a)(),componentId:t.id,type:"add",data:Object(j.cloneDeep)(t)}),e.isDirty=!0,e.isChangedNotPublished=!0},undo(e){-1===e.historyIndex?e.historyIndex=e.histories.length-1:e.historyIndex--;const t=e.histories[e.historyIndex];switch(t.type){case"add":e.components=e.components.filter(e=>e.id!==t.componentId);break;case"delete":e.components=Object(g.d)(e.components,t.index,t.data);break;case"modify":w(e,t,"undo")}},redo(e){if(-1===e.historyIndex)return;const t=e.histories[e.historyIndex];switch(t.type){case"add":e.components.push(t.data);break;case"delete":e.components=e.components.filter(e=>e.id!==t.componentId);break;case"modify":w(e,t,"redo")}e.historyIndex++},setActive(e,t){e.currentElement=t},setEditing(e,t){e.currentEditing=t},updatePage(e,{key:t,value:s,level:a}){const n=e.page;if(a){if("props"===a){const o=n[a][t];I(o,()=>{y(e,{id:Object(b.a)(),type:"modify",data:{oldValue:v,newValue:s,key:t}})})}n[a][t]=s}else n[t]=s;e.isDirty=!0,e.isChangedNotPublished=!0},moveComponent(e,t){const s=e.components.find(t=>t.id===e.currentElement);if(s){const e=this,a=parseInt(s.props.top),n=parseInt(s.props.left),{direction:o,amount:r}=t;switch(o){case"Up":{const t=a-r+"px";e.commit("updateComponent",{key:"top",value:t,isProps:!0});break}case"Down":{const t=a+r+"px";e.commit("updateComponent",{key:"top",value:t,isProps:!0});break}case"Left":{const t=n-r+"px";e.commit("updateComponent",{key:"left",value:t,isProps:!0});break}case"Right":{const t=n+r+"px";e.commit("updateComponent",{key:"left",value:t,isProps:!0});break}}}},updateComponent(e,{id:t,key:s,value:a,isProps:n}){const o=e.components.find(s=>s.id===(t||e.currentElement));if(o){if(n){const n=Array.isArray(s)?s.map(e=>o.props[e]):o.props[s];I(n,()=>{y(e,{id:Object(b.a)(),componentId:t||e.currentElement,type:"modify",data:{oldValue:v,newValue:a,key:s}})}),Array.isArray(s)?s.forEach((e,t)=>{o.props[e]=a[t]}):o.props[s]=a}else o[s]=a;e.isDirty=!0,e.isChangedNotPublished=!0}},copyComponent(e,t){const s=e.components.find(e=>e.id===t);s&&(e.copiedComponent=s)},pasteCopiedComponent(e){if(e.copiedComponent){const t=Object(j.cloneDeep)(e.copiedComponent);t.id=Object(b.a)(),t.layerName=t.layerName+"副本",e.components.push(t),e.isDirty=!0,e.isChangedNotPublished=!0,y(e,{id:Object(b.a)(),componentId:t.id,type:"add",data:Object(j.cloneDeep)(t)})}},deleteComponent(e,t){const s=e.components.find(e=>e.id===t),a=e.components.findIndex(e=>e.id===t);e.components=e.components.filter(e=>e.id!==t),y(e,{id:Object(b.a)(),componentId:s.id,type:"delete",data:s,index:a}),e.isDirty=!0,e.isChangedNotPublished=!0},getWork(e,{data:t}){const{content:s,...a}=t;e.page={...e.page,...a},s.props&&(e.page.props={...e.page.props,...s.props}),s.setting&&(e.page.setting={...e.page.setting,...s.setting}),e.components=s.components},getChannels(e,{data:t}){e.channels=t.list},createChannel(e,{data:t}){e.channels=[...e.channels,t]},deleteChannel(e,{extraData:t}){e.channels=e.channels.filter(e=>e.id!==t.id)},saveWork(e){e.isDirty=!1,e.page.updatedAt=(new Date).toISOString()},copyWork(e){e.page.updatedAt=(new Date).toISOString()},publishWork(e){e.isChangedNotPublished=!1,e.page.latestPublishAt=(new Date).toISOString()},publishTemplate(e){e.page.isTemplate=!0}},actions:{saveAndPublishWork({dispatch:e,state:t},s){const{id:a}=t.page;return e("saveWork",s).then(()=>e("publishWork",a)).then(()=>e("getChannels",a)).then(()=>0===t.channels.length?e("createChannel",{name:"默认",workId:a}):Promise.resolve({}))}},getters:{getCurrentElement:e=>e.components.find(t=>t.id===e.currentElement),checkUndoDisable:e=>0===e.histories.length||0===e.historyIndex,checkRedoDisable:e=>0===e.histories.length||e.historyIndex===e.histories.length||-1===e.historyIndex}};var z={state:{token:localStorage.getItem("token")||"",isLogin:!1,data:{}},mutations:{fetchCurrentUser(e,t){e.isLogin=!0,e.data={...t.data}},updateUser(e,{data:t,extraData:s}){const{token:a}=t.data;e.data={...e.data,...s},e.token=a,localStorage.setItem("token",a),o.a.defaults.headers.common.Authorization="Bearer "+a},login(e,t){const{token:s}=t.data;e.token=s,localStorage.setItem("token",s),o.a.defaults.headers.common.Authorization="Bearer "+s},logout(e){e.token="",e.isLogin=!1,localStorage.removeItem("token"),delete o.a.defaults.headers.common.Authorization}},actions:{fetchCurrentUser:({commit:e})=>D("/users/getUserInfo","fetchCurrentUser",e),login:({commit:e},t)=>D("/users/loginByPhoneNumber","login",e,{method:"post",data:t}),loginAndFetch:({dispatch:e},t)=>e("login",t).then(()=>e("fetchCurrentUser")),updateUser:({commit:e},t)=>D("/users/updateUserInfo","updateUser",e,{method:"patch",data:t},t),updateUserAndFetch:({dispatch:e},t)=>e("updateUser",t).then(()=>e("fetchCurrentUser"))}};var O={state:{templates:[],works:[],totalWorks:0,statics:[],totalTemplates:0,searchText:""},mutations:{fetchTemplates(e,{data:t,extraData:s}){const{pageIndex:a,searchText:n}=s,{list:o,count:r}=t.data;e.templates=0===a?o:[...e.templates,...o],e.totalTemplates=r,e.searchText=n||""},fetchTemplate(e,{data:t}){e.templates=[t]},fetchWorks(e,{data:t,extraData:s}){const{pageIndex:a,searchText:n}=s,{list:o,count:r}=t.data;e.works=o,e.totalWorks=r,e.searchText=n||""},createWork(e,{data:t}){e.works.unshift(t)},deleteWork(e,{extraData:t}){e.works=e.works.filter(e=>e.id!==t.id)},recoverWork(e,{extraData:t}){e.works=e.works.filter(e=>e.id!==t.id)},transferWork(e,{data:t,extraData:s}){0===t.errno&&(e.works=e.works.filter(e=>e.id!==s.id))},fetchStatic(e,{data:t,extraData:s}){const a=t.data,{name:n,id:o}=s;e.statics.push({name:n,id:o,list:a})},clearStatic(e){e.statics=[]}},actions:{fetchTemplates({commit:e},t={pageIndex:0,pageSize:8,title:""}){t.title||delete t.title;const s=Object(g.e)(t);return D("/templates?"+s,"fetchTemplates",e,{method:"get"},{pageIndex:t.pageIndex,searchText:t.title})},fetchTemplate:({commit:e},t)=>D("/templates/"+t,"fetchTemplate",e),fetchWorks({commit:e},t={pageIndex:0,pageSize:8,title:""}){t.title||delete t.title;const s=Object(g.e)(t);return D("/works?"+s,"fetchWorks",e,{method:"get"},{pageIndex:t.pageIndex,searchText:t.title})},deleteWork:({commit:e},t)=>D("/works/"+t,"deleteWork",e,{method:"delete"},{id:t}),createWork:({commit:e},t)=>D("/works","createWork",e,{method:"post",data:t}),fetchStatic({commit:e},t){const s={category:"h5",action:"pv",...t},a=Object(g.e)(s);return D(`${T}/api/event?${a}`,"fetchStatic",e,{method:"get"},{name:t.name,id:t.label})},recoverWork:({commit:e},t)=>D("/works/put-back/"+t,"recoverWork",e,{method:"post"},{id:t}),transferWork:({commit:e},{id:t,username:s})=>D(`/works/transfer/${t}/${s}`,"transferWork",e,{method:"post"},{id:t})},getters:{getCurrentTemplate:e=>t=>e.templates.find(e=>e.id===parseInt(t))}};const D=async(e,t,s,a={method:"get"},n)=>{const r={...a,mutationName:t},{data:i}=await o()(e,r);return s(t,n?{data:i,extraData:n}:i),i};var E=Object(h.a)({state:{userState:{},status:{loading:!1,error:{status:!1,message:""},opName:""},editorState:{},worksState:{}},mutations:{setLoading(e,{status:t,opName:s}){e.status.loading=t,s&&(e.status.opName=s)},setError(e,t){e.status.error=t}},modules:{editor:C,user:z,works:O}});let P="",S="",T="";Object({NODE_ENV:"production",BASE_URL:"https://disjfjdizmfnkf.github.io/editor/"}).VUE_APP_IS_STAGING,P="",S="",T="",o.a.defaults.baseURL=P+"/api/";const U=Object(a.i)(m);let N=0,W="";o.a.interceptors.request.use(e=>{const t=e;E.commit("setLoading",{status:!0,opName:t.mutationName}),E.commit("setError",{status:!1,message:""}),N=Date.now();const{baseURL:s,url:a}=e;return W=`${null==s?void 0:s.slice(0,-1)}${a}`,e}),o.a.interceptors.response.use(e=>(E.commit("setLoading",{status:!1}),0!==e.data.errno?(E.commit("setError",{status:!0,message:e.data.message}),Promise.reject(e.data)):(N=Date.now()-N,window.__bl&&window.__bl.api&&window.__bl.api(W,!0,N,0,e.data.message),e)),e=>{const t=e.response?e.response.data:e.message;return E.commit("setError",{status:!0,message:t}),E.commit("setLoading",{status:!1}),N=Date.now()-N,window.__bl&&window.__bl.api&&window.__bl.api(W,!1,N,-1,t),Promise.reject(t)}),U.use(E).use(f).use(r.a).use(i.a),U.mount("#app")}},[[0,"runtime","npm.ant-design-vue","npm.moment","npm.lodash","vendors~app"]]]);